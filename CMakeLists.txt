CMAKE_MINIMUM_REQUIRED( VERSION 3.2 )

PROJECT( psql_tools )

IF ( NOT DEFINED POSTGRES_INSTALLATION_DIR )
    SET( POSTGRES_INSTALLATION_DIR "/usr/lib/postgresql/12/bin" )
ENDIF()

SET( CMAKE_POSITION_INDEPENDENT_CODE ON )
SET( CMAKE_SKIP_INSTALL_ALL_DEPENDENCY TRUE )
SET( BUILD_SHARED_LIBS ON )

INCLUDE( ExternalProject )

SET( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_SOURCE_DIR}/cmake )

INCLUDE( compiler )
INCLUDE( git )
INCLUDE( libraries )
INCLUDE( postgres )
INCLUDE( sql_extension )
INCLUDE( targets )
INCLUDE( tests )

SETUP_OUTPUT_DIRECTORIES()

GENERATE_GIT_VERSION_FILE()
GET_RUNTIME_POSTGRES_VARIABLES()

set(CMAKE_INSTALL_RPATH ${POSTGRES_LIBDIR})
SET(CMAKE_INSTALL_PREFIX ${POSTGRES_LIBDIR} CACHE PATH "DEFAULT PREFIX" FORCE)

ENABLE_TESTING()

ADD_SUBDIRECTORY( src )

ADD_SUBDIRECTORY( tests )
